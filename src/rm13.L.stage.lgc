[ ********************************************************************[[ rm13.L.stage[[ The centre of the Opera Stage[[ ********************************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define fStageFall f220#define fAtTrap f221#define StageTrap o1[ **************************************[ FIRST CYCLE ONLY[ **************************************if(newRoom)    {    [ load, draw and discard the picture for the current room    load.pic(currentRoom);    draw.pic(currentRoom);    discard.pic(currentRoom);        [ the horizon defines the upper limit of ego's movement    set.horizon(62);        [ add additional room initialization here        if(!TrapDoor) {     load.view(v.stages);     animate.obj(StageTrap);     set.view(StageTrap,v.stages);     set.loop(StageTrap,0);     position(StageTrap,156,91);     stop.cycling(StageTrap);     draw(StageTrap);     }             [ load ego view, animate and draw ego    [ this is sometimes handled in logic 0    [ instead of in each individual logic    if (previousRoom == 61) { [Stage Left     position(ego,4,118);     }    if (previousRoom == 9) { [Trap room     position(ego,151,101);     set.loop(ego,2);     egoDir=0;     }    load.sound(s.falling);       draw(ego);    [ display the picture on screen    show.pic();    }[ **************************************[ EVERY CYCLE[ **************************************[ add other room specific statements here[ **************************************[ PROCESS PLAYER INPUT[ **************************************if (edgeEgoHit == LEFT_EDGE) { new.room(61); [ ##LE001## }if (edgeEgoHit == RIGHT_EDGE) { new.room(59); [ ##LE002##}if (egoHitSpecial) { [stage edgeif (!fAtTrap) { if(!posn(ego,139,80,159,110)) { [not by trap door  set(fStageFall); print("You take one step too far."); erase(ego); animate.obj(o16); load.view(1); set.view(o16,1); set.loop(o16,2); position.v(o16,egoX,egoY); draw(o16); sound(s.falling,soundDone); } else { [trap door  if (TrapDoor) { [trap is open   print("You remember to watch your step near the open trap.");   if (egoDir < 3) {    egoDir=7;    }   if (egoDir < 5 && egoDir > 2) {    egoDir= 7;    }   if (egoDir==5) {    egoDir=1;         }   }  } } [end of !AtTrap else { [AtTrap=1, going to clinb through player.control(); new.room(9); [ ##LE003## }} [closes HitSpecialif (fStageFall) {  if (soundDone) {  shake.screen(2);  deathType=3;}}    [ if player hasn't provided input, or if a match has already[ been found no need to do said testsif((!haveInput || haveMatch))    {    goto(done);    }if ((said("climb", "trap") ||     said("enter", "trap") ||     said("use", "trap") ||     said("enter", "hole"))) {     if (TrapDoor) { [trap open      set(fAtTrap);      move.obj(ego,154,94,0,soundDone);      }     else {      print("You can't climb through a closed trap door. You must find another way down there.");      }}if (said("open", "trap")) { if (TrapDoor) {  print("The trap is already open.");  } else {  print("As hard as you try, you'll never open the trap from up here. Besides knowing your luck you'd only fall through if you succeeded.");  }}if ((said("look", "trap") ||     said("look", "hole"))) {      if (!TrapDoor) {       s1 = "shut.";       }      else {       s1 = "open.";       }      print("The trap door gives access to the trap room beneath the stage, useful for theatrical effects. It is currently %s1");}if ((said("lick", "trap") ||     said("lick", "hole"))) { print("Even as a proud Frenchman, Raoul, you should know better than to put your tongue in strange holes.");}if (said("lick", "stage")) { if (!Is1881) {  print("The stage is oddly tasteless, given it has been polished with over a century's-worth of feet from the corps du ballet.");  } else {  print("You taste fresh polish and ballerina feet.");  }}if (said("smell", "stage")) { print("Your nose detects no trace of the Phantom on the stage.");}[ place said tests hereif(said("look"))    {    print("You stand on the stage of the Op‚ra Garnier.");    }    if (said("look", "stage")) { print("The polished stage floor almost gleams. You wonder how many hours of performances it has seen."); } if (said("look", "auditorium")) { print("The house is hard to make out from the stage, thanks to the lights shining in your face. (Someone should have reduced them, really).");}if (said("look", "music")) { print("Music stands cheekily poke their heads above the stage."); } if (said("look", "curtain")) {    print("The luxurious theatre curtains are currently pulled back.");    }if (said("get", "curtain")) {    print("You can't go around stealing pieces of fabric. Besides they're too big for your apartment.");    }if (said("taste", "curtain")) { print("The fabric sucks all the moisture from your tongue."); }if (said("smell", "curtain")) { print("On olfactory inspection alone, the curtain seems to be made of ancient sweat and stale tobacco."); }:donereturn();[ **************************************[ MESSAGES[ **************************************#message 1 "You see nothing of interest." 